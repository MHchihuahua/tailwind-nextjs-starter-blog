---
title: 'JS30 - 01 Drum Kit'
date: '2025-01-29'
tags: ['JS30', 'JavaScript']
draft: false
summary: 'JS30 Day1 æŒ‘æˆ°ï¼Œåˆ©ç”¨ JavaScript è£½ä½œä¸€å€‹æ‰“æ“Šæ¨‚å™¨ã€‚é€éæŒ‰ä¸‹éµç›¤æŒ‰éˆ•ï¼Œæ’­æ”¾å°æ‡‰çš„éŸ³æ•ˆï¼Œä¸¦ä¸”åœ¨æŒ‰ä¸‹æŒ‰éµæ™‚ç”¢ç”Ÿå‹•ç•«æ•ˆæœ'
authors: ['default']
images: ['/static/images/JS30.jpg']
canonicalUrl:
---

![](https://mhchihuahua.github.io/JavaScript30/images/01.png)

ğŸš€ [Demo Link](https://mhchihuahua.github.io/JavaScript30/01/)

Drum Kit æŒ‘æˆ°æ˜¯ç•¶æŒ‰ä¸‹éµç›¤æŒ‰éµæ™‚ï¼Œæœƒç™¼å‡ºä¸åŒçš„é¼“è²éŸ³æ•ˆ

- é€é `keydown` äº‹ä»¶ç›£è½éµç›¤æŒ‰éµ
- é€éäº‹ä»¶ä»£ç†èˆ‡ç‰©ä»¶å„²å­˜ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡è¤‡æŸ¥è©¢ï¼Œæå‡æ•ˆèƒ½

---

### ç›£è½éµç›¤äº‹ä»¶

ç›£è½ `keydown` äº‹ä»¶ï¼Œç•¶æŒ‰ä¸‹éµç›¤æŒ‰éµæ™‚ï¼Œæœƒè§¸ç™¼ `playSound` äº‹ä»¶

```javascript
window.addEventListener('keydown', playSound)
```

### å„²å­˜ audio å’Œ key å…ƒç´ 

ä½¿ç”¨ç‰©ä»¶ä¾†å„²å­˜æ¯å€‹æŒ‰éµèˆ‡å…¶å°æ‡‰çš„éŸ³æ•ˆå…ƒç´ ï¼Œé¿å…é‡è¤‡æŸ¥è©¢ DOMï¼Œæå‡æ•ˆèƒ½

```javascript
const audioElements = {}
const keyElements = {}

const keys = document.querySelectorAll('.key')
keys.forEach((key) => {
  keyElements[key.dataset.key] = key
})

const audios = document.querySelectorAll('audio[data-key]')
audios.forEach((audio) => {
  audioElements[audio.dataset.key] = audio
})
```

- é€é `dataset.key` å–å¾—æ¯å€‹å…ƒç´ çš„ `data-key` å±¬æ€§ï¼Œä¸¦å°‡å…¶å°æ‡‰çš„ `key` å’Œ `audio` å…ƒç´ å„²å­˜åˆ°ç‰©ä»¶ä¸­

### æ’­æ”¾éŸ³æ•ˆä¸¦åŠ ä¸Šå‹•ç•«æ•ˆæœ

ç•¶è§¸ç™¼ `keydown` äº‹ä»¶æ™‚ï¼Œæœƒæ ¹æ“šæŒ‰éµç¢¼ï¼ˆ`e.code`ï¼‰å–å¾—å°æ‡‰çš„éŸ³æ•ˆèˆ‡æŒ‰éµå…ƒç´ ï¼Œæ’­æ”¾éŸ³æ•ˆä¸¦åŠ ä¸Š `.playing` é¡åˆ¥ä¾†å•Ÿå‹•å‹•ç•«æ•ˆæœ

```javascript
const playSound = (e) => {
  const audio = audioElements[e.code]
  const key = keyElements[e.code]

  if (!audio || !key) return

  audio.currentTime = 0
  audio.play()
  key.classList.add('playing')
}
```

- `e.code` å°æ‡‰æ¯å€‹æŒ‰éµï¼Œä¸¦æ’­æ”¾å°æ‡‰çš„éŸ³æ•ˆ
  - åŸæœ¬æ•™å­¸ä½¿ç”¨ `e.keyCode` ï¼Œä½†å®˜ç¶²è¡¨ç¤ºé€™å€‹å±¬æ€§[å·²ç¶“ deprecated](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode)ï¼Œæ‰€ä»¥æ”¹ç”¨ `e.code` ä¾†å–å¾—æŒ‰éµç¢¼
- `audio.currentTime = 0` ç¢ºä¿éŸ³æ•ˆå¯ä»¥å¾é ­é–‹å§‹æ’­æ”¾

### ç§»é™¤å‹•ç•«æ•ˆæœ

ç•¶éæ¸¡å‹•ç•«çµæŸæ™‚ï¼Œæˆ‘å€‘éœ€è¦ç§»é™¤ `.playing` é¡åˆ¥ï¼Œä½¿æŒ‰éµå‹•ç•«æ¢å¾©åˆå§‹ç‹€æ…‹

```javascript
const removeTransition = (e) => {
  if (e.propertyName !== 'transform') return
  e.target.classList.remove('playing')
}
```

- å› ç‚º `transform` çµæŸè¼ƒæ™šï¼Œæ‰€ä»¥åªè¦ `transform` çµæŸå°±å¯ä»¥ç§»é™¤ `.playing` é¡åˆ¥

### ç›£è½éæ¸¡å‹•ç•«çµæŸäº‹ä»¶

åŸæœ¬çš„å¯«æ³•æ˜¯ç‚ºæ¯å€‹ `.key` å…ƒç´ åˆ†åˆ¥ç¶å®š `transitionend` äº‹ä»¶

```javascript
keys.forEach((key) => {
  key.addEventListener('transitionend', removeTransition)
})
```

ä½†å¯ä»¥æ”¹ç‚ºä½¿ç”¨äº‹ä»¶ä»£ç†ï¼ˆEvent Delegationï¼‰ï¼Œä¾†å° `.keys` çˆ¶å…ƒç´ çµ±ä¸€ç›£è½ï¼Œé€™æ¨£ä¸åƒ…èƒ½æ¸›å°‘ç›£è½å™¨çš„æ•¸é‡ï¼Œé‚„èƒ½æé«˜æ•ˆèƒ½

```javascript
document.querySelector('.keys').addEventListener('transitionend', removeTransition)
```

- ç•¶ä»»ä½•å­å…ƒç´ çš„ `transition` çµæŸæ™‚ï¼Œäº‹ä»¶æœƒå†’æ³¡åˆ°çˆ¶å…ƒç´  `.keys`ï¼Œè§¸ç™¼ `removeTransition` äº‹ä»¶

---

## åƒè€ƒè³‡æ–™

- [data-\*](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/data-*)
- [Using data attributes](https://developer.mozilla.org/en-US/docs/Learn_web_development/Howto/Solve_HTML_problems/Use_data_attributes)
- [HTMLElement: dataset property](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset)
